{% extends '../toolbar_index.html' %}

{% block head %}
<style type="text/css">
.sendbox{width: 600px;margin: 0 auto;}
.sendbox h2{font-size: 28px;margin-bottom: 30px;}
.sendbox .form-control{height: 120px;}
</style>
{% endblock %}

{% block main %}
<div class="container sendbox">
  <h2>给{{bean.name}}发站内信</h2>
  <form class="form-horizontal">
  <input type="hidden" name="receiver_id" value="{{bean.id}}">
    <div class="form-group">
      <div class="col-sm-12">
        <textarea name="content" class="form-control" maxlength="200"></textarea>
      </div>
      <!-- <div class="col-sm-6"></div> -->
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <button type="submit" class="btn btn-primary">send</button>
      </div>
    </div>
  </form>
</div>
</div>
{% endblock %}

{% block foot %}
<script>
  var valid_en={  
    content: {
      required: "Please provide content",
      maxlength: "content can not more than 500 characters long"
    }
    
  }
var valid_zh={
    
    content: {
      required: "请输入内容",
      maxlength: "内容最长500个字符"
    }
  }  
var messages=valid_en;

$("form").validate({
  rules: {
    content: {
      required: true,
      maxlength: 500
    }
  },
  messages: messages,
  errorElement: "em"

});

$("form").on('submit',function(e){

    var $this=$(this);
    if(!$this.valid()){
       return false;
     }
    var id=$this.find("input[name=id]").val();
    var method=id?"PUT":"POST";
   var data=$(this).serialize();
    $.ajax({
        type: method,
        url: "/api/message",
        data:data,
        dataType:"json",
        success:function(json){
            if(json.code=='success'){
             YY.dialog({content:json.code}).alert();
            	history.go(-1);
            }
            if(json.code=='myself'){
              alert("自己不能给自己发信");
            }
        }
    });

    return false;
});
</script>  
{% endblock %}