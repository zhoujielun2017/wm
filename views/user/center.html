{% extends '../base.html' %}

{% block head %}
<style type="text/css">
.glyphicon-user{
  font-size: 70px;
  color: #eee;
}
.head label{
    display: block;
    width: 100px;
    height: 100px;
    background: #999;
}
.head label img{
  height: inherit;
  width: inherit;
  }
  input[name=file]{
    display: none;
  }
.change a{display: inline-block;padding: 15px 3px;}
</style>
{% endblock %}

{% block main %}
  <input type="hidden" name="imgdomain" value="{{img_domain}}">
   <input type="hidden" name="id" value="{{user.id}}">

<div class="head">
     <label for="uploadfile">
      <!-- <span class="glyphicon glyphicon-user" aria-hidden="true"></span> -->
      {% if not user.head_url %}
      <img src="" alt="" class="img-rounded">
      {% endif %}
      {% if  user.head_url  %}
      <img src="{{img_domain}}{{user.head_url }}" alt="" class="img-rounded">
      {% endif %}
    </label>
    <input type="file" name="file" id="uploadfile">
</div>




 <h3>{{user.email}}</h3>
 <p>{{__('type user')}}:
 	{% if user.type=='factory' %}
  		{{__('factory')}}
	{% endif %}
	{% if user.type=='agency' %}
	  	{{__('agency')}}
	{% endif %}
	{% if user.type=='seller' %}
	  	{{__('seller')}}
	{% endif %}
	{% if user.type=='design' %}
	  	{{__('design')}}
	{% endif %}
 </p>
 <p>{{__('role of user')}}:
{% if user.role==0 %}
  <a href="/user/buy">{{__('to be vip')}}</a>
{% endif %}
{% if user.role==1 %}
  高级会员
{% endif %}
{% if user.role==9 %}
  管理员
{% endif %}
</p>
 <p>{{__('all message')}}:(18)</p>
 <p>{{__('last login time')}}:{{user.last_login_time|formatdate("YYYY-MM-DD HH:mm:ss")}}</p>
{% endblock %}

{% block foot %}
 <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
 <script src="/js/upyun.js"></script>
 <script src="/js/upload.js"></script>
<script>
	// client side only need bucket name
    $("#uploadfile").on("change",function(){
        $.fileupload(this,function(data){
            var path=data.path;
            console.log("返回结果",path);
            var domain=$("input[name=imgdomain]").val();
            var id=$("input[name=id]").val();
            
             $.ajax({
                type: "PUT",
                url: "/user/"+id,
                 data:{
                  head_url:path
                },
                dataType:"json",
                success:function(json){
                    if(json.code="success"){
                       $(".head img")[0].src=domain+path;
                    }
                }
            });
        });
    })
</script>  
{% endblock %}