{% extends './base.html' %}

{% block main %}
<table class="table table-hover">
    <thead>
    <tr>
        <th>Name</th>
        <th>operation</th>
    </tr>
    </thead>
    <tbody>
    {% for e in list %}
    <tr>
        <td >{{e.title}}</td>
        <td><a href="/api/wiki/{{e.id}}" class="btn btn-danger" role="button" data-id="{{e.id}}">del</a>
            <a href="#" class="btn btn-primary update" role="button" data-id="{{e.id}}">update</a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<form class="form-horizontal" action="/api/wiki">
    <input type="hidden" name="id" value="{{bean.id}}">
    <div class="form-group">
        <label class="col-sm-2 control-label">title</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" name="title" placeholder="title" value="{{bean.title}}">
        </div>
    </div>
    <div class="form-group">
        <label  class="col-sm-2 control-label">content</label>
        <div class="col-sm-10">
            <textarea name="content">{{bean.content}}</textarea>
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-primary">保存</button>
        </div>
    </div>
</form>
{% endblock %}
{% block foot %}
<script src="http://cdn.ckeditor.com/4.7.1/standard-all/ckeditor.js"></script>
<script>
    var editor = CKEDITOR.replace( 'content', Common.editorConfig);
    $("form").on('submit',function(e){

        var fd=new FormData(this);
        var method=fd.get('id')?"PUT":"POST";
        console.log(this.method);

        $.ajax({
            type: method,
            url: this.action,
            data:{id:fd.get('id'),title:fd.get('title'),content:editor.getData()},
            dataType:"json",
            success:function(json){
                alert(json);
                console.log(json);
            }
        });

        return false;
    });
    $(".table .update").on("click",function(){
        var id=$(this).data("id");
        var form=$("form");
        $.ajax({
            type: "GET",
            url: "/api/wiki/"+id,
            dataType:"json",
            success:function(json){
                form.find("input[name=id]").val(json.id);
                form.find("input[name=title]").val(json.title);
                editor.setData(json.content);               
            }
        });
        return false;
    });
</script>
{% endblock %}